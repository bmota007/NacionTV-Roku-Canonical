<?xml version="1.0" encoding="UTF-8"?>
<component name="RowListContentTask" extends="Task">
  <interface>
    <field id="content" type="node" />
  </interface>

  <script type="text/brightscript" uri="pkg:/components/Config.brs"/>
  <script type="text/brightscript"><![CDATA[

    Sub Init()
      m.top.functionName = "loadContent"
    End Sub

    Sub loadContent()
      array = loadConfig()

      ' Build tiles in the order you want:
      intl = invalid
      hou  = invalid

      for each element in array
        if element <> invalid and element.Title <> invalid then
          t = UCase(element.Title)
          if t = "INTERNACIONAL" then intl = element
          if t = "HOUSTON" then hou = element
        end if
      end for

      ordered = []
      if intl <> invalid then ordered.push(intl)
      if hou  <> invalid then ordered.push(hou)

      oneRow = GetApiArray(ordered)

      list = [
        {
          Title: "My Channels",
          ContentList : oneRow
        }
      ]

      m.top.content = ParseXMLContent(list)
    End Sub

    Function ParseXMLContent(list As Object) As Object
      RowItems = CreateObject("roSGNode","ContentNode")

      for each rowAA in list
        row = CreateObject("roSGNode","ContentNode")
        row.Title = rowAA.Title

        for each itemAA in rowAA.ContentList
          item = CreateObject("roSGNode","ContentNode")
          item.SetFields(itemAA)
          row.AppendChild(item)
        end for

        RowItems.AppendChild(row)
      end for

      return RowItems
    End Function

    Function GetApiArray(array As Object) As Object
      result = []
      for each element in array
        item = {}
        item.Title = element.Title
        item.streamFormat = element.streamFormat
        item.HDPosterUrl = element.Logo
        item.Url = element.Stream
        result.Push(item)
      end for
      return result
    End Function

  ]]></script>
</component>